<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>PLC Hub - Filter by Test</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    select, label { font-size: 14px; margin-right: 10px; }
    canvas { max-width: 100%; margin-top: 30px; }
    table { width: 100%; border-collapse: collapse; margin-top: 40px; font-size: 14px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    th { background-color: #f2f2f2; }
  </style>
</head>
<body>

<h1>PLC Hub - Filter by Assessment</h1>

<label for="testSelect"><strong>Select Assessment(s):</strong></label>
<select id="testSelect" multiple size="10"></select>

<canvas id="barChart"></canvas>
<canvas id="lineChart"></canvas>

<h2>Full Assignment Table</h2>
<table id="dataTable">
  <thead>
    <tr><th>Assignment</th><th>Skill</th><th>Students</th><th>%4s</th><th>%3s</th><th>%2s</th><th>%1s</th><th>% Proficient</th></tr>
  </thead>
  <tbody></tbody>
</table>

<script>
const data = [
  { "name": "Atoms", "skill": "Scientific Writing (SEP6 & SEP7)", "4s": 0.0, "3s": 60.4, "2s": 26.7, "1s": 9.8, "proficient": 60.4, "students": 722 },
  { "name": "Chemical Reactions", "skill": "Scientific Writing (SEP6 & SEP7)", "4s": 0.0, "3s": 48.8, "2s": 32.9, "1s": 15.5, "proficient": 48.8, "students": 653 },
  { "name": "States of Matter", "skill": "Scientific Writing (SEP6 & SEP7)", "4s": 0.0, "3s": 54.3, "2s": 33.6, "1s": 9.4, "proficient": 54.3, "students": 724 },
  { "name": "Isotopes", "skill": "Scientific Writing (SEP6 & SEP7)", "4s": 0.0, "3s": 64.2, "2s": 24.8, "1s": 9.0, "proficient": 64.2, "students": 709 },
  { "name": "Balancing #2", "skill": "Scientific Writing (SEP6 & SEP7)", "4s": 0.0, "3s": 59.5, "2s": 26.6, "1s": 10.5, "proficient": 59.5, "students": 707 }
];

const testSelect = document.getElementById('testSelect');
const barCtx = document.getElementById('barChart').getContext('2d');
const lineCtx = document.getElementById('lineChart').getContext('2d');
let barChart, lineChart;

// Populate dropdown
const assessments = [...new Set(data.map(d => d.name))].sort();
assessments.forEach(name => {
  const opt = document.createElement('option');
  opt.value = name;
  opt.textContent = name;
  testSelect.appendChild(opt);
});

function updateCharts() {
  const selected = Array.from(testSelect.selectedOptions).map(o => o.value);
  if (selected.length === 0) {
    if (barChart) barChart.destroy();
    if (lineChart) lineChart.destroy();
    return;
  }

  const filtered = data.filter(d => selected.includes(d.name));
  const labels = filtered.map(d => d.name);

  const barData = {
    labels: ["4s", "3s", "2s", "1s"],
    datasets: filtered.map((entry, i) => ({
      label: entry.name + ' (Skill: ' + entry.skill + ')',
      data: [entry["4s"], entry["3s"], entry["2s"], entry["1s"]],
      backgroundColor: `hsl(${i * 50 % 360}, 60%, 60%)`
    }))
  };
  if (barChart) barChart.destroy();
  barChart = new Chart(barCtx, {
    type: 'bar',
    data: barData,
    options: {
      responsive: true,
      plugins: {
        title: {
          display: true,
          text: '% Distribution by Proficiency Level'
        }
      },
      scales: {
        y: {
          beginAtZero: true,
          max: 100,
          title: { display: true, text: '% of Students' }
        }
      }
    }
  });

  const lineData = {
    labels: labels,
    datasets: [{
      label: "% Proficient (4s+3s)",
      data: filtered.map(d => d.proficient),
      fill: false,
      borderColor: "cornflowerblue",
      tension: 0.3,
      pointRadius: 5,
      pointHoverRadius: 7
    }]
  };
  if (lineChart) lineChart.destroy();
  lineChart = new Chart(lineCtx, {
    type: 'line',
    data: lineData,
    options: {
      responsive: true,
      plugins: {
        title: { display: true, text: 'Proficiency Over Time' }
      },
      scales: {
        y: {
          beginAtZero: true,
          max: 100,
          title: { display: true, text: '% Proficient' }
        },
        x: { title: { display: true, text: 'Assignment' } }
      }
    }
  });
}

// Table display
const tableBody = document.querySelector('#dataTable tbody');
data.forEach(row => {
  const tr = document.createElement('tr');
  tr.innerHTML = `<td>${row.name}</td><td>${row.skill}</td><td>${row.students}</td>
    <td>${row["4s"]}</td><td>${row["3s"]}</td><td>${row["2s"]}</td><td>${row["1s"]}</td>
    <td>${row.proficient}</td>`;
  tableBody.appendChild(tr);
});

testSelect.addEventListener('change', updateCharts);
</script>

</body>
</html>
